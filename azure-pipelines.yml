trigger:
- main

variables:
- group: kv-secrets

stages:
- stage: FetchToken
  jobs:
  - job: UseGitHubToken
    pool:
      vmImage: ubuntu-latest

    steps:
    - task: AzureKeyVault@2
      inputs:
        azureSubscription: 'azure-kv-connection'
        KeyVaultName: 'kv-github-demo'
        SecretsFilter: 'github-token'
        RunAsPreJob: true

    - script: |
        echo "Token fetched successfully"
        echo "GitHub Token Length: ${#GITHUB_TOKEN}"
      env:
        GITHUB_TOKEN: $(github-token)
